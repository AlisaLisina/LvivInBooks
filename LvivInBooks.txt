create database LvivInBooks -- creating a database for my possible project for university 

go

use LvivInBooks

go

create table BOOKS
	(
	ID int identity (1,1) Primary key,
	Title nvarchar(500), 
	PubHouse nvarchar(200),
	Language nvarchar(200),
	Annotation nvarchar(max)
	)

	go

create table AUTHORS
	(
	ID int identity (1,1) Primary key,
	FirstName nvarchar(50), 
	LastName nvarchar(50) 

	)

	go

create table GENRES
	(
	ID int identity (1,1) Primary key,
	Name nvarchar(100) 
	)

	go

create table AUTHORS_BOOKS
	(
	ID int identity (1,1) Primary key,
	ARef int Foreign key references Authors(ID),
	BRef int Foreign key references Books(ID)
	)

go
	
create table GENRES_BOOKS
	(
	ID int identity (1,1) Primary key,
	GRef int Foreign key references Genre(ID),
	BRef int Foreign key references Books(ID)
	)

	go 


ALTER TABLE BOOKS
ALTER COLUMN Title nvarchar(100) NOT NULL; -

ALTER TABLE AUTHORS
ADD Nationality nvarchar (20);

ALTER TABLE AUTHORS
ADD CONSTRAINT Nationality 
DEFAULT 'Ukrainian' FOR Nationality; -- studing constraints topic

ALTER TABLE AUTHORS   
   ADD CONSTRAINT CHK_FirstName_AUTHORS   
   CHECK (FirstName LIKE '_%');  
GO 
                      
ALTER TABLE AUTHORS   
   ADD CONSTRAINT CHK_LastName_AUTHORS   
   CHECK (LastName LIKE '_%' and LastName LIKE N'%[A-ß, à-ÿ,ª,º,¯,¿,²,³,'']');  -- making a constraint, where user can add only cyrillic symbols + ukrainian specific letters, such as 'ї, є, і' 
GO

ALTER TABLE GENRES
ADD UNIQUE (Name);

CREATE VIEW view_Love 
AS 
SELECT * FROM BOOKS
WHERE Annotation LIKE N'%êîõàííÿ%';

SELECT * FROM view_Love
--
/*CREATE VIEW view_PopularAuthors -- âèáèðàº íàéïðîäóêòèâí³øîãî àâòîðà (õ3 )
AS 
SELECT TOP 3 WITH TIES *
FROM AUTHORS 
WHERE AUTHORS.ID IN (
                     SELECT TOP 3 WITH TIES ARef
                     FROM AUTHORS_BOOKS
                     GROUP BY ARef
                     ORDER BY COUNT(BRef) DESC)
ORDER BY AUTHORS.LastName; 					-- creating a view, which shows a 'top 3' most productive authors

SELECT * FROM view_PopularAuthors*/
--
CREATE VIEW view_length -- âèáèðàº àííîòàö³þ äî 100 ñèìâîë³â
AS
  SELECT Title, LEN(Annotation) as length
  FROM BOOKS
  WHERE LEN(Annotation) <=100;

SELECT * FROM view_length
-----------------------------CLUSTERED|NONCLUSTERED----------------------------------------------
CREATE VIEW v_clustered WITH SCHEMABINDING  
AS
  SELECT ID, Title, PubHouse, Language, Annotation
  FROM dbo.BOOKS
  WHERE Annotation LIKE N'%Ëüâ³â%'

CREATE UNIQUE CLUSTERED INDEX books_indexed
ON v_clustered
             (Title,
              PubHouse
                      );
CREATE NONCLUSTERED INDEX books_nonclustered
ON v_clustered
              (ID,
              Language
              );

--------------------------------STORED PROCEDURES-----------------------------------------
CREATE PROC spTopAuthors 
AS 
  SELECT TOP 3 WITH TIES *
  FROM AUTHORS 
  WHERE AUTHORS.ID IN (
                       SELECT TOP 3 WITH TIES ARef
                       FROM AUTHORS_BOOKS
                       GROUP BY ARef
                       ORDER BY COUNT(BRef) DESC)
  ORDER BY AUTHORS.LastName;
GO

EXEC spTopAuthors;

/*CREATE PROC spNewAuthor
@FirstName nvarchar (50),
@LastName nvarchar (50)
AS
  IF EXIST (SELECT FirstName, LastName 
            FROM AUTHORS
            WHERE FirstName = @FirstName
              AND   LastName = @LastName)
            PRINT N'Òàêèé àâòîð âæå º'
  ELSE 
  BEGIN 
   INSERT INTO AUTHORS
   VALUES (@FirstName, @LastName)
   PRINT N'Àâòîð óñï³øíî äîäàíèé äî áàçè'
  END*/
						-- a procedure, which insert data about author and if it already exists - then shows 'this author already exists'
CREATE PROC dbo.spNewAuthor
@FirstName nvarchar (50),
@LastName nvarchar (50)
AS

BEGIN 
          
     INSERT INTO AUTHORS (FirstName, LastName)
     VALUES (@FirstName, @LastName)
END

EXEC dbo.spNewAuthor
     @FirstName = 'Àë³ñà', 			-- checking code for problems 
     @LastName = 'Ë³ñ³íà'






